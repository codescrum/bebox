set :pre_provision_phases, ['common_dev', 'puppet_install', 'apply_users']

if pre_provision_phases.include?(phase)
	set :user, "vagrant"
	set :ssh_key, '~/.vagrant.d/insecure_private_key'
	set :copy_exclude, [".git", ".gitignore", ".gitmodules", "*.box", "boxes", "keys", "puppet"]
else
	set :user, "puppet"
	set :ssh_key, 'keys/puppet.rsa'
	set :copy_exclude, [".git", ".gitignore", ".gitmodules", "*.box", "boxes", "keys", "initial_puppet"]
end
set :application, "pname"
set :deploy_via, :copy
set :scm, :none
set :repository, "."


set :ssh_options, {
  :keys => ssh_key,
  :port => '22',
  :forward_agent => 'true'
}

server "server1.pname.test", :web, :app, :db

desc 'Test the vagrant connection by doing issuing a simple echo command'
task :probe, roles: [:web, :app, :db] do
  run 'echo $PATH'
end